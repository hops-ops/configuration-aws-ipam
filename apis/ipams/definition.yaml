apiVersion: apiextensions.crossplane.io/v2
kind: CompositeResourceDefinition
metadata:
  name: ipams.aws.hops.ops.com.ai
spec:
  scope: Namespaced
  group: aws.hops.ops.com.ai
  names:
    kind: IPAM
    plural: ipams
  versions:
  - name: v1alpha1
    referenceable: true
    served: true
    schema:
      openAPIV3Schema:
        type: object
        description: IPAM defines AWS VPC IP Address Manager primitives for downstream compositions.
        required:
        - spec
        properties:
          spec:
            type: object
            description: Desired state for the IPAM resources.
            required:
            - region
            - pools
            properties:
              managementPolicies:
                type: array
                description: Management operations permitted on composed resources. Use ["*"] for full management or omit Delete to orphan.
                items:
                  type: string
                  enum:
                  - "*"
                  - Create
                  - Observe
                  - Update
                  - Delete
                  - LateInitialize
                default:
                - "*"
              providerConfigRef:
                type: object
                description: Reference to the ProviderConfig for AWS API operations.
                properties:
                  kind:
                    type: string
                    description: Kind of the provider config (ProviderConfig or ClusterProviderConfig).
                    enum:
                      - ProviderConfig
                      - ClusterProviderConfig
                    default: ProviderConfig
                  name:
                    type: string
                    description: Name of the provider config.
                    default: default
                required:
                  - name
              externalName:
                type: string
                description: |
                  IPAM ID to adopt (e.g., ipam-0123456789abcdef0).
                  When set, Crossplane imports the existing IPAM instead of creating a new one.
              forProvider:
                type: object
                description: Override any forProvider field on the VPCIpam resource. Keys here overwrite template defaults.
                x-kubernetes-preserve-unknown-fields: true
              region:
                type: string
                description: AWS region hosting the IPAM instance.
              operatingRegions:
                type: array
                description: |
                  Additional AWS regions where the IPAM can allocate CIDRs.
                  Pool regions are automatically included based on each pool's region/locale.
                  Use this to pre-provision regions before pools are defined there.
                items:
                  type: string
              scopes:
                type: array
                description: |
                  Optional custom IPAM scopes. By default, pools use the IPAM's built-in
                  privateDefaultScope or publicDefaultScope. Define custom scopes here
                  when you need isolated scope spaces (e.g., per-team isolation).
                items:
                  type: object
                  required:
                  - name
                  properties:
                    name:
                      type: string
                      description: Unique name for the scope, referenced by pools via scopeRef.
                    externalName:
                      type: string
                      description: |
                        IPAM Scope ID to adopt (e.g., ipam-scope-0123456789abcdef0).
                        When set, Crossplane imports the existing scope instead of creating a new one.
                    description:
                      type: string
                      description: Description for the scope.
                    tags:
                      type: object
                      description: Extra AWS tags merged with the default tag map.
                      x-kubernetes-preserve-unknown-fields: true
              pools:
                type: object
                description: IPAM pools organized by address family and type.
                required:
                - ipv4
                properties:
                  ipv4:
                    type: array
                    description: IPv4 address pools.
                    minItems: 1
                    items:
                      type: object
                      required:
                      - name
                      x-kubernetes-preserve-unknown-fields: true
                      properties:
                        name:
                          type: string
                          description: Unique identifier for the pool used in downstream selectors.
                        sourcePoolRef:
                          type: string
                          description: |
                            Reference to a parent pool by name (within same IPAM).
                            Creates a child pool that allocates from the parent's CIDR space.
                        externalName:
                          type: string
                          description: |
                            IPAM Pool ID to adopt (e.g., ipam-pool-0123456789abcdef0).
                            When set, Crossplane imports the existing pool instead of creating a new one.
                        managementPolicies:
                          type: array
                          description: |
                            ManagementPolicies for this pool. Overrides spec.managementPolicies if set.
                            Use to orphan specific pools on deletion while deleting others.
                          items:
                            type: string
                            enum:
                            - "*"
                            - Create
                            - Observe
                            - Update
                            - Delete
                            - LateInitialize
                        forProvider:
                          type: object
                          description: Override any forProvider field on the VPCIpamPool resource.
                          x-kubernetes-preserve-unknown-fields: true
                        cidr:
                          type: string
                          description: Base CIDR for the pool (e.g., 10.0.0.0/8).
                        netmaskLength:
                          type: integer
                          minimum: 8
                          maximum: 32
                          description: Netmask length for auto-assigned CIDR. Conflicts with cidr.
                        cidrExternalName:
                          type: string
                          description: |
                            VPCIpamPoolCidr external name to adopt. Format: cidr_pool-id
                            (e.g., 10.0.0.0/8_ipam-pool-0123456789abcdef0).
                        scopeRef:
                          type: string
                          description: Reference to a custom scope defined in spec.scopes by name.
                        region:
                          type: string
                          description: AWS region where the pool resource is managed. Defaults to spec.region.
                        locale:
                          type: string
                          description: |
                            AWS region where CIDRs from this pool can be allocated.
                            When set, only VPCs in this region can use addresses from the pool.
                            Leave unset for top-level pools; set on regional child pools.
                        description:
                          type: string
                          description: Optional description attached to the pool.
                        allocations:
                          type: object
                          description: Allocation constraints for this pool.
                          properties:
                            netmaskLength:
                              type: object
                              description: Netmask length constraints for allocations from this pool.
                              properties:
                                default:
                                  type: integer
                                  minimum: 8
                                  maximum: 32
                                  description: Default netmask length assigned to new allocations.
                                min:
                                  type: integer
                                  minimum: 8
                                  maximum: 32
                                  description: Minimum netmask length allowed within the pool.
                                max:
                                  type: integer
                                  minimum: 8
                                  maximum: 32
                                  description: Maximum netmask length allowed within the pool.
                        labels:
                          type: object
                          description: Labels propagated to VpcIpamPool resources.
                          x-kubernetes-preserve-unknown-fields: true
                        tags:
                          type: object
                          description: Extra AWS tags merged with the default tag map.
                          x-kubernetes-preserve-unknown-fields: true
                  ipv6:
                    type: object
                    description: IPv6 address pools.
                    properties:
                      ula:
                        type: array
                        description: |
                          IPv6 Unique Local Address (ULA) pools. These are private IPv6 addresses
                          from the fd00::/8 range, auto-assigned by AWS based on netmaskLength.
                          Always use the IPAM's private scope.
                        items:
                          type: object
                          required:
                          - name
                          x-kubernetes-preserve-unknown-fields: true
                          properties:
                            name:
                              type: string
                              description: Unique identifier for the pool used in downstream selectors.
                            sourcePoolRef:
                              type: string
                              description: Reference to a parent ULA pool by name (within same IPAM).
                            externalName:
                              type: string
                              description: IPAM Pool ID to adopt (e.g., ipam-pool-0123456789abcdef0).
                            managementPolicies:
                              type: array
                              description: ManagementPolicies for this pool. Overrides spec.managementPolicies if set.
                              items:
                                type: string
                                enum:
                                - "*"
                                - Create
                                - Observe
                                - Update
                                - Delete
                                - LateInitialize
                            forProvider:
                              type: object
                              description: Override any forProvider field on the VPCIpamPool resource.
                              x-kubernetes-preserve-unknown-fields: true
                            netmaskLength:
                              type: integer
                              minimum: 9
                              maximum: 128
                              description: Netmask length for AWS to auto-assign from fd00::/8 range.
                            cidrExternalName:
                              type: string
                              description: VPCIpamPoolCidr external name to adopt.
                            scopeRef:
                              type: string
                              description: |
                                Reference to a custom private scope defined in spec.scopes by name.
                                When not set, uses the IPAM's default private scope.
                            region:
                              type: string
                              description: AWS region where the pool resource is managed. Defaults to spec.region.
                            locale:
                              type: string
                              description: |
                                AWS region where CIDRs from this pool can be allocated.
                                When set, only VPCs in this region can use addresses from the pool.
                                Leave unset for top-level pools; set on regional child pools.
                            description:
                              type: string
                              description: Optional description attached to the pool.
                            allocations:
                              type: object
                              description: Allocation constraints for this pool.
                              properties:
                                netmaskLength:
                                  type: object
                                  description: Netmask length constraints for allocations from this pool.
                                  properties:
                                    default:
                                      type: integer
                                      minimum: 9
                                      maximum: 128
                                      description: Default netmask length assigned to new allocations.
                                    min:
                                      type: integer
                                      minimum: 9
                                      maximum: 128
                                      description: Minimum netmask length allowed within the pool.
                                    max:
                                      type: integer
                                      minimum: 9
                                      maximum: 128
                                      description: Maximum netmask length allowed within the pool.
                            labels:
                              type: object
                              description: Labels propagated to VpcIpamPool resources.
                              x-kubernetes-preserve-unknown-fields: true
                            tags:
                              type: object
                              description: Extra AWS tags merged with the default tag map.
                              x-kubernetes-preserve-unknown-fields: true
                      gua:
                        type: array
                        description: |
                          IPv6 Global Unicast Address (GUA) pools. These are public IPv6 addresses
                          provided by Amazon. Always use the IPAM's public scope with amazonProvidedIpv6CidrBlock.
                        items:
                          type: object
                          required:
                          - name
                          x-kubernetes-preserve-unknown-fields: true
                          properties:
                            name:
                              type: string
                              description: Unique identifier for the pool used in downstream selectors.
                            sourcePoolRef:
                              type: string
                              description: Reference to a parent GUA pool by name (within same IPAM).
                            externalName:
                              type: string
                              description: IPAM Pool ID to adopt (e.g., ipam-pool-0123456789abcdef0).
                            managementPolicies:
                              type: array
                              description: ManagementPolicies for this pool. Overrides spec.managementPolicies if set.
                              items:
                                type: string
                                enum:
                                - "*"
                                - Create
                                - Observe
                                - Update
                                - Delete
                                - LateInitialize
                            forProvider:
                              type: object
                              description: Override any forProvider field on the VPCIpamPool resource.
                              x-kubernetes-preserve-unknown-fields: true
                            netmaskLength:
                              type: integer
                              minimum: 40
                              maximum: 52
                              default: 52
                              description: |
                                Netmask length for the Amazon-provided IPv6 CIDR block.
                                AWS limits this to /40-/52. Default /52 provides 16 VPC allocations.
                            cidrExternalName:
                              type: string
                              description: VPCIpamPoolCidr external name to adopt.
                            publicIpSource:
                              type: string
                              description: Source of public IP addresses. Defaults to amazon.
                              enum:
                              - amazon
                              - byoip
                              default: amazon
                            awsService:
                              type: string
                              description: AWS service for IPv6 allocation. Defaults to ec2.
                              default: ec2
                            region:
                              type: string
                              description: AWS region where the pool resource is managed. Defaults to spec.region.
                            locale:
                              type: string
                              description: |
                                AWS region where CIDRs from this pool can be allocated.
                                When set, only VPCs in this region can use addresses from the pool.
                                Leave unset for top-level pools; set on regional child pools.
                            description:
                              type: string
                              description: Optional description attached to the pool.
                            allocations:
                              type: object
                              description: |
                                Allocation constraints for VPCs from this pool.
                                VPCs support /44 to /60 in increments of /4 (e.g., /44, /48, /52, /56, /60).
                              properties:
                                netmaskLength:
                                  type: object
                                  description: Netmask length constraints for VPC allocations.
                                  properties:
                                    default:
                                      type: integer
                                      minimum: 44
                                      maximum: 60
                                      default: 56
                                      description: Default netmask for VPC allocations. Must be /44, /48, /52, /56, or /60.
                                    min:
                                      type: integer
                                      minimum: 44
                                      maximum: 60
                                      description: Minimum netmask allowed. Must be /44, /48, /52, /56, or /60.
                                    max:
                                      type: integer
                                      minimum: 44
                                      maximum: 60
                                      description: Maximum netmask allowed. Must be /44, /48, /52, /56, or /60.
                            labels:
                              type: object
                              description: Labels propagated to VpcIpamPool resources.
                              x-kubernetes-preserve-unknown-fields: true
                            tags:
                              type: object
                              description: Extra AWS tags merged with the default tag map.
                              x-kubernetes-preserve-unknown-fields: true
          status:
            type: object
            description: Observed state of the IPAM resources.
            properties:
              id:
                type: string
                description: AWS IPAM ID.
              arn:
                type: string
                description: AWS IPAM ARN.
              privateDefaultScopeId:
                type: string
                description: IPAM's built-in default private scope ID.
              publicDefaultScopeId:
                type: string
                description: IPAM's built-in default public scope ID.
              pools:
                type: object
                description: Observed state of IPAM pools.
                properties:
                  ipv4:
                    type: array
                    description: Observed IPv4 pools.
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        id:
                          type: string
                        arn:
                          type: string
                        cidr:
                          type: string
                  ipv6:
                    type: object
                    description: Observed IPv6 pools.
                    properties:
                      ula:
                        type: array
                        description: Observed IPv6 ULA pools.
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            id:
                              type: string
                            arn:
                              type: string
                            cidr:
                              type: string
                      gua:
                        type: array
                        description: Observed IPv6 GUA pools.
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            id:
                              type: string
                            arn:
                              type: string
                            cidr:
                              type: string
        
